<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mundari Admin Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow&family=Cormorant+Garamond:wght@600;700&family=Dancing+Script&family=Fira+Sans&family=Inconsolata&family=Lato&family=Lora&family=Merriweather&family=Montserrat&family=Mukta&family=Nunito&family=Open+Sans&family=Oswald&family=Outfit:wght@300;400;500;600&family=PT+Sans&family=Playfair+Display&family=Quicksand&family=Raleway&family=Roboto&family=Source+Sans+3&family=Work+Sans&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2d6a4f; --primary-light: #52b788; --bg-gradient: linear-gradient(135deg, #f3f9f5 0%, #eaf4f4 100%); --glass: rgba(255, 255, 255, 0.9); --border-soft: #e0eadd; --text: #1b4332; }
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg-gradient); color: var(--text); padding-bottom: 80px; min-height: 100vh; }
        .app-bar { background: var(--primary); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(45, 106, 79, 0.2); }
        .app-bar h2 { margin:0; font-family: 'Cormorant Garamond', serif; font-size: 22px; }
        .nav-tabs { background: rgba(255,255,255,0.8); backdrop-filter: blur(5px); display: flex; overflow-x: auto; padding: 10px 5px; margin-bottom: 15px; border-bottom: 1px solid var(--border-soft); scrollbar-width: none; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .tab { flex: 0 0 auto; padding: 8px 16px; margin-right: 8px; border-radius: 20px; font-size: 14px; font-weight: 500; color: var(--text); transition: 0.3s; cursor: pointer; }
        .tab.active { background: var(--primary); color: white; }
        .container { padding: 15px; max-width: 600px; margin: auto; }
        .card { background: var(--glass); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); border: 1px solid white; }
        h3 { font-family: 'Cormorant Garamond', serif; color: var(--primary); margin-top: 0; font-size: 20px;}
        label { display:block; font-size: 13px; font-weight:600; margin-bottom: 5px; color: var(--text); }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid var(--border-soft); border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; font-family: 'Outfit', sans-serif; transition: 0.3s; }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); outline: none; background: white; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; color: white; transition: 0.2s; font-family: 'Outfit', sans-serif; }
        .btn-primary { background: var(--primary); }
        .btn-accent { background: var(--primary-light); }
        .btn-update { background: #e67e22; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; background: white; border-radius: 10px; margin-bottom: 8px; }
        .list-item img { width: 45px; height: 45px; border-radius: 8px; object-fit: cover; margin-right: 10px; }
        .item-info { flex: 1; font-size: 14px; font-weight: 500; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .action-btns { display: flex; gap: 5px; }
        .btn-mini { padding: 6px 12px; font-size: 12px; border-radius: 8px; border:none; cursor:pointer; color: white; font-weight:600; }
        .bg-edit { background: #f39c12; }
        .bg-del { background: #e74c3c; }

        /* EDITOR */
        .editor-fullscreen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; height: 100dvh; background: #fdfdfd; z-index: 2000; flex-direction: column; }
        .editor-fullscreen.active { display: flex; }
        .editor-header { padding: 12px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: white; flex-shrink: 0; }
        .editor-scroll-area { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
        #editor-content { flex: 1; padding: 25px; outline: none; font-size: 18px; line-height: 1.8; color: #222; font-family: 'Outfit', sans-serif; padding-bottom: 20px; }
        
        .toolbar { padding: 10px; background: white; display: flex; gap: 10px; overflow-x: auto; border-top: 1px solid #eee; align-items: center; white-space: nowrap; scrollbar-width: none; flex-shrink: 0; box-shadow: 0 -4px 15px rgba(0,0,0,0.05); }
        .toolbar::-webkit-scrollbar { display: none; }
        .toolbar button { border: 1px solid #eee; background: #f9f9f9; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; color: #333; }
        input[type="color"] { width: 35px; height: 35px; border: none; border-radius: 50%; padding: 0; cursor: pointer; background: transparent; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 2px solid #ddd; border-radius: 50%; }
        .color-btn { width: 25px; height: 25px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer; display: inline-block; flex-shrink: 0; }
    </style>
</head>
<body>

    <div class="app-bar">
        <h2>Admin Panel</h2>
        <div onclick="window.location.href='index.html'" style="font-size:13px; color:rgba(255,255,255,0.8); cursor:pointer;">Logout ‚ûú</div>
    </div>

    <div class="nav-tabs">
        <div class="tab active" onclick="openTab('settings')">Settings</div>
        <div class="tab" onclick="openTab('hero')">Hero</div>
        <div class="tab" onclick="openTab('articles')">Articles</div>
        <div class="tab" onclick="openTab('videos')">Videos</div>
        <div class="tab" onclick="openTab('gallery')">Gallery</div>
        <div class="tab" onclick="openTab('backup')">Publish</div>
    </div>

    <div class="container">
        <div id="settings" class="section active">
            <div class="card">
                <h3>Website Settings</h3>
                <label>Website Logo URL</label><input type="text" id="site-logo">
                <label>Contact Email</label><input type="text" id="contact-email">
                <label>Footer Text</label><textarea id="footer-text" rows="2"></textarea>
                <label>Welcome Title</label><input type="text" id="w-title">
                <label>Welcome Subtitle</label><input type="text" id="w-sub">
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
        <div id="hero" class="section">
            <div class="card">
                <h3>Slider Images</h3>
                <input type="text" id="evt-img" placeholder="Image URL">
                <button id="btn-event" class="btn btn-accent" onclick="addEvent()">+ Add Image</button>
                <div id="event-list" style="margin-top:20px;"></div>
            </div>
        </div>
        <div id="articles" class="section">
            <div class="card">
                <button class="btn btn-primary" onclick="toggleEditor(true)">üìù Write New Article</button>
                <div id="article-list-view" style="margin-top:20px;"></div>
            </div>
        </div>
        <div id="videos" class="section">
             <div class="card">
                <h3>Videos</h3>
                <input type="text" id="vid-link" placeholder="Video Link (YouTube)">
                <input type="text" id="vid-title" placeholder="Video Title">
                <input type="text" id="vid-thumb" placeholder="Thumbnail URL">
                <button id="btn-video" class="btn btn-accent" onclick="addVideo()">Add Video</button>
                <div id="video-list" style="margin-top:20px;"></div>
            </div>
        </div>
        <div id="gallery" class="section">
             <div class="card">
                <h3>Gallery</h3>
                <input type="text" id="pho-link" placeholder="Photo URL">
                <input type="text" id="pho-title" placeholder="Photo Caption">
                <button id="btn-photo" class="btn btn-accent" onclick="addPhoto()">Add Photo</button>
                <div id="photo-list" style="margin-top:20px;"></div>
            </div>
        </div>
        <div id="backup" class="section">
            <div class="card">
                <h3>Backup</h3>
                <p style="font-size:14px; color:#555;">Download data.js to save changes permanently.</p>
                <button class="btn btn-primary" onclick="downloadBackup()">Download data.js</button>
            </div>
        </div>
    </div>

    <div id="editor-screen" class="editor-fullscreen">
        <div class="editor-header">
            <button onclick="toggleEditor(false)" style="border:none;background:none;color:#e74c3c;font-weight:bold;font-size:16px;cursor:pointer;">Cancel</button>
            <b style="font-family:'Cormorant Garamond', serif; font-size:22px; color:var(--primary);">Editor</b>
            <button onclick="publishArticle()" style="background:var(--primary);color:white;padding:8px 20px;border-radius:20px;border:none;font-weight:bold;cursor:pointer;">Save</button>
        </div>
        
        <div class="editor-scroll-area">
            <div style="padding:20px; background:white; border-bottom:1px solid #eee;">
                <input type="text" id="art-title" placeholder="Article Title..." style="font-size:22px; font-weight:bold; border:none; padding:0; margin-bottom:10px; font-family:'Cormorant Garamond', serif;">
                <input type="text" id="art-thumb" placeholder="Cover Image URL..." style="font-size:14px; border:none; border-bottom:1px solid #eee; padding:5px 0; margin:0; border-radius:0;">
            </div>
            <div id="editor-content" contenteditable="true" placeholder="Start writing your article here..."></div>
        </div>

        <div class="toolbar">
            <button onmousedown="event.preventDefault(); format('bold')"><b>B</b></button>
            <button onmousedown="event.preventDefault(); format('italic')"><i>I</i></button>
            <button onmousedown="event.preventDefault(); format('underline')"><u>U</u></button>
            <button onmousedown="event.preventDefault(); format('insertUnorderedList')">‚Ä¢ List</button>
            <button onmousedown="event.preventDefault(); format('formatBlock', 'H2')">H2</button>
            
            <select id="font-select" onmousedown="saveSelection()" onchange="applyFont(this.value)" style="width:auto; margin:0; padding:6px 10px; font-size:14px;">
                <option value="Outfit">Outfit</option>
                <option value="Roboto">Roboto</option>
                <option value="Open Sans">Open Sans</option>
                <option value="Lato">Lato</option>
                <option value="Montserrat">Montserrat</option>
                <option value="Oswald">Oswald</option>
                <option value="Source Sans 3">Source Sans Pro</option>
                <option value="Raleway">Raleway</option>
                <option value="PT Sans">PT Sans</option>
                <option value="Merriweather">Merriweather</option>
                <option value="Nunito">Nunito</option>
                <option value="Playfair Display">Playfair Display</option>
                <option value="Lora">Lora</option>
                <option value="Mukta">Mukta</option>
                <option value="Work Sans">Work Sans</option>
                <option value="Fira Sans">Fira Sans</option>
                <option value="Quicksand">Quicksand</option>
                <option value="Barlow">Barlow</option>
                <option value="Inconsolata">Inconsolata</option>
                <option value="Dancing Script">Dancing Script</option>
            </select>

            <input type="color" id="native-color" onmousedown="saveSelection()" onchange="applyColor(this.value)">
            <div class="color-btn" style="background:#000000;" onmousedown="event.preventDefault(); format('foreColor', '#000000')"></div>
            <div class="color-btn" style="background:#1b4332;" onmousedown="event.preventDefault(); format('foreColor', '#1b4332')"></div>
            <div class="color-btn" style="background:#2d6a4f;" onmousedown="event.preventDefault(); format('foreColor', '#2d6a4f')"></div>
            <div class="color-btn" style="background:#e74c3c;" onmousedown="event.preventDefault(); format('foreColor', '#e74c3c')"></div>
            <div class="color-btn" style="background:#3498db;" onmousedown="event.preventDefault(); format('foreColor', '#3498db')"></div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let editingId = null;
        let savedRange = null; 

        document.execCommand("defaultParagraphSeparator", false, "p");
        document.execCommand("styleWithCSS", false, true);

        function saveSelection() { const sel = window.getSelection(); if (sel.getRangeAt && sel.rangeCount) savedRange = sel.getRangeAt(0); }
        function restoreSelection() { if (savedRange) { const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(savedRange); } }
        function format(cmd, val) { document.execCommand(cmd, false, val); }
        function applyFont(fontName) { restoreSelection(); document.execCommand('fontName', false, fontName); document.getElementById('font-select').value = 'Outfit'; }
        function applyColor(colorValue) { restoreSelection(); document.execCommand('foreColor', false, colorValue); }

        // SAFELY load admin data without breaking the page on older devices
        if (db.admin) {
            document.getElementById('site-logo').value = db.admin.logo ? db.admin.logo : '';
            document.getElementById('contact-email').value = db.admin.contactEmail ? db.admin.contactEmail : '';
            document.getElementById('footer-text').value = db.admin.footerText ? db.admin.footerText : '';
            document.getElementById('w-title').value = db.admin.welcomeTitle ? db.admin.welcomeTitle : '';
            document.getElementById('w-sub').value = db.admin.welcomeSub ? db.admin.welcomeSub : '';
        }

        function openTab(id) {
            document.querySelectorAll('.section').forEach(function(e) { e.classList.remove('active'); });
            document.querySelectorAll('.tab').forEach(function(e) { e.classList.remove('active'); });
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
            resetEditMode(); 
        }

        function resetEditMode() {
            editingId = null;
            document.getElementById('btn-video').innerText = "Add Video"; document.getElementById('btn-video').className = "btn btn-accent";
            document.getElementById('btn-photo').innerText = "Add Photo"; document.getElementById('btn-photo').className = "btn btn-accent";
            document.getElementById('btn-event').innerText = "+ Add Image"; document.getElementById('btn-event').className = "btn btn-accent";
            clearInputs();
        }

        function clearInputs() {
            document.getElementById('vid-link').value = ''; document.getElementById('vid-title').value = ''; document.getElementById('vid-thumb').value = '';
            document.getElementById('pho-link').value = ''; document.getElementById('pho-title').value = '';
            document.getElementById('evt-img').value = ''; document.getElementById('art-title').value = ''; document.getElementById('art-thumb').value = '';
            document.getElementById('editor-content').innerHTML = '';
        }

        function saveSettings() {
            if(!db.admin) db.admin = {}; 
            db.admin.logo = document.getElementById('site-logo').value; 
            db.admin.contactEmail = document.getElementById('contact-email').value;
            db.admin.footerText = document.getElementById('footer-text').value; 
            db.admin.welcomeTitle = document.getElementById('w-title').value;
            db.admin.welcomeSub = document.getElementById('w-sub').value; 
            saveData(); 
            alert("Settings Saved!");
        }

        function addVideo() {
            const link = document.getElementById('vid-link').value; const title = document.getElementById('vid-title').value; const thumb = document.getElementById('vid-thumb').value;
            if(!link || !title) return alert("Link and Title required!");
            if(editingId) { const item = db.videos.find(function(x) { return x.id === editingId; }); if(item) { item.link = link; item.title = title; item.thumbnail = thumb; } } 
            else { db.videos.unshift({ id: Date.now(), link: link, title: title, thumbnail: thumb }); }
            saveData(); renderLists(); resetEditMode();
            alert("Video Saved!");
        }

        function addPhoto() {
            const link = document.getElementById('pho-link').value; const title = document.getElementById('pho-title').value;
            if(!link) return alert("Image URL required!");
            if(editingId) { const item = db.photos.find(function(x) { return x.id === editingId; }); if(item) { item.image = link; item.title = title || 'Untitled'; } } 
            else { db.photos.unshift({ id: Date.now(), image: link, title: title || 'Untitled' }); }
            saveData(); renderLists(); resetEditMode();
            alert("Photo Saved!");
        }

        function addEvent() {
            const img = document.getElementById('evt-img').value;
            if(!img) return alert("Image URL required!");
            if(editingId) { const item = db.events.find(function(x) { return x.id === editingId; }); if(item) { item.image = img; } } 
            else { db.events.unshift({ id: Date.now(), image: img }); }
            saveData(); renderLists(); resetEditMode();
            alert("Slider Image Saved!");
        }

        function toggleEditor(show) { document.getElementById('editor-screen').classList.toggle('active', show); if(!show) resetEditMode(); }

        function publishArticle() {
            const title = document.getElementById('art-title').value; const thumb = document.getElementById('art-thumb').value; const content = document.getElementById('editor-content').innerHTML;
            if(!title) return alert("Title required!");
            if(editingId) { const item = db.articles.find(function(x) { return x.id === editingId; }); if(item) { item.title = title; item.thumbnail = thumb; item.content = content; } } 
            else { db.articles.unshift({ id: Date.now(), title: title, thumbnail: thumb, content: content }); }
            saveData(); toggleEditor(false); renderLists(); resetEditMode();
            alert("Article Published Successfully!");
        }

        function editItem(type, id) {
            const item = db[type].find(function(x) { return x.id === id; }); if(!item) return;
            editingId = id; 
            if(type === 'videos') { openTab('videos'); document.getElementById('vid-link').value = item.link; document.getElementById('vid-title').value = item.title; document.getElementById('vid-thumb').value = item.thumbnail || ''; document.getElementById('btn-video').innerText = "Update Video"; document.getElementById('btn-video').className = "btn btn-update"; window.scrollTo(0,0); }
            else if(type === 'photos') { openTab('gallery'); document.getElementById('pho-link').value = item.image; document.getElementById('pho-title').value = item.title; document.getElementById('btn-photo').innerText = "Update Photo"; document.getElementById('btn-photo').className = "btn btn-update"; window.scrollTo(0,0); }
            else if(type === 'events') { openTab('hero'); document.getElementById('evt-img').value = item.image; document.getElementById('btn-event').innerText = "Update Image"; document.getElementById('btn-event').className = "btn btn-update"; window.scrollTo(0,0); }
            else if(type === 'articles') { document.getElementById('art-title').value = item.title; document.getElementById('art-thumb').value = item.thumbnail; document.getElementById('editor-content').innerHTML = item.content; toggleEditor(true); }
        }

        function deleteItem(type, id) {
            if(confirm("Delete this item?")) { db[type] = db[type].filter(function(x) { return x.id !== id; }); saveData(); renderLists(); if(editingId === id) resetEditMode(); }
        }

        function renderLists() {
            const renderRow = function(i, type) {
                let img = i.image || i.thumbnail || 'https://via.placeholder.com/40'; let title = i.title || 'ID: ' + i.id;
                return `<div class="list-item"><div style="display:flex; align-items:center; overflow:hidden;"><img src="${img}"><div class="item-info">${title}</div></div><div class="action-btns"><button class="btn-mini bg-edit" onclick="editItem('${type}', ${i.id})">Edit</button><button class="btn-mini bg-del" onclick="deleteItem('${type}', ${i.id})">Del</button></div></div>`;
            };
            document.getElementById('event-list').innerHTML = db.events.map(function(i) { return renderRow(i, 'events'); }).join('');
            document.getElementById('article-list-view').innerHTML = db.articles.map(function(i) { return renderRow(i, 'articles'); }).join('');
            document.getElementById('video-list').innerHTML = db.videos.map(function(i) { return renderRow(i, 'videos'); }).join('');
            document.getElementById('photo-list').innerHTML = db.photos.map(function(i) { return renderRow(i, 'photos'); }).join('');
        }
        renderLists();
    </script>
</body>
</html>