<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link id="dynamic-favicon" rel="icon" href="https://via.placeholder.com/100/2d6a4f/ffffff?text=M" type="image/png">
    
    <title>Mundari Samaj</title>
    <meta name="description" content="Welcome to the official Mundari Samaj digital platform. Preserving our culture, language, and traditions.">
    <meta property="og:title" content="Mundari Samaj">
    <meta property="og:description" content="Preserving our culture, language, and traditions for future generations.">
    <meta property="og:image" content="https://via.placeholder.com/600x315/2d6a4f/ffffff?text=Mundari+Samaj">
    <meta property="og:type" content="website">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- THEME VARIABLES --- */
        :root { 
            --primary: #2d6a4f; 
            --primary-light: #52b788; 
            --bg-gradient: linear-gradient(135deg, #f0f7f4 0%, #e8f5e9 100%); 
            --glass: rgba(255, 255, 255, 0.75); 
            --border-soft: #e0eadd; 
            --text: #1b4332; 
        }
        
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg-gradient); color: var(--text); padding-bottom: 40px; overflow-x: hidden; min-height: 100vh; }
        body.menu-open { overflow: hidden !important; height: 100vh !important; }

        /* --- HEADER --- */
        header { background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo-area { display: flex; align-items: center; gap: 12px; }
        .logo { width: 42px; height: 42px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); padding: 2px; background: white; display: block; }
        .app-title { font-family: 'Cormorant Garamond', serif; font-weight: 700; font-size: 24px; color: var(--primary); margin: 0; }

        /* --- MENU OVERLAY --- */
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(20, 50, 35, 0.65); backdrop-filter: blur(4px); z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s ease; display: flex; justify-content: center; align-items: center; will-change: opacity; }
        .menu-overlay.active { opacity: 1; visibility: visible; }
        .menu-center-box { width: 85%; max-width: 360px; background: #fff; border-radius: 20px; box-shadow: 0 25px 60px rgba(0,0,0,0.3); transform: scale(0.9) translateZ(0); opacity: 0; transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); padding: 25px; display: flex; flex-direction: column; gap: 15px; will-change: transform, opacity; }
        .menu-overlay.active .menu-center-box { transform: scale(1) translateZ(0); opacity: 1; }

        .menu-header-top { display: flex; justify-content: flex-end; }
        .close-icon { font-size: 28px; color: #aaa; cursor: pointer; line-height: 1; transition:0.2s; }
        
        .search-wrapper { position: relative; margin-bottom: 5px; }
        .search-bar { width: 100%; padding: 12px 40px 12px 15px; border-radius: 12px; border: 1px solid var(--border-soft); background: #fdfdfd; font-family: 'Outfit', sans-serif; font-size: 15px; box-sizing: border-box; transition: 0.3s; }
        .search-bar:focus { outline:none; border-color: var(--primary); background:white; }
        .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; }
        .search-results { background: white; margin-top: 5px; border-radius: 8px; max-height: 150px; overflow-y: auto; border: 1px solid #eee; display: none; position: absolute; width: 100%; z-index: 10; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .search-item { padding: 12px; border-bottom: 1px solid #f5f5f5; font-size: 14px; color: #555; cursor: pointer; }

        .nav-vertical { display: flex; flex-direction: column; gap: 10px; }
        .nav-row { padding: 14px 20px; background: white; border: 1px solid var(--border-soft); border-radius: 12px; text-decoration: none; color: var(--text); font-weight: 500; font-size: 16px; display: flex; justify-content: space-between; }
        
        .login-link { text-align: center; margin-top: 10px; padding: 10px; color: var(--primary); font-weight: 600; cursor: pointer; font-size: 15px; opacity: 0.8; text-decoration: none; display: block; }

        /* --- CONTENT --- */
        .slider-wrapper { width: 92%; height: 220px; margin: 20px auto; border-radius: 20px; overflow: hidden; position: relative; background: #e8f5e9; border: 4px solid white; box-shadow: 0 10px 30px rgba(45, 106, 79, 0.12); transform: translateZ(0); }
        .slide-img { width: 100%; height: 100%; object-fit: cover; position: absolute; opacity: 0; transition: opacity 0.8s ease; will-change: opacity; }
        .slide-img.active { opacity: 1; }

        .section-title { padding: 0 25px; margin-top: 30px; margin-bottom: 10px; font-family: 'Outfit', sans-serif; font-weight: 600; font-size: 18px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .section-title::before { content:''; width: 5px; height: 20px; background: var(--primary); border-radius: 4px; }
        
        .scroll-feed { display: flex; gap: 15px; overflow-x: auto; padding: 5px 25px 30px 25px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .scroll-feed::-webkit-scrollbar { display: none; }

        .card { flex: 0 0 160px; background: rgba(255,255,255,0.9); border-radius: 16px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid white; cursor: pointer; }
        .c-img { width: 100%; height: 110px; object-fit: cover; background: #eaf4f4; }
        .c-body { padding: 12px; }
        .c-title { font-size: 14px; font-weight: 600; margin: 0; line-height: 1.4; }
        
        /* Default Video Card (Reels/Shorts) */
        .vid-card { flex: 0 0 140px; }
        .vid-card .c-img { height: 200px; }
        
        /* Landscape Video Card (YouTube) */
        .vid-landscape { flex: 0 0 240px; }
        .vid-landscape .c-img { height: 135px; object-fit: cover; }

        footer { background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(255, 255, 255, 0.8); margin: 40px 20px; border-radius: 24px; padding: 40px 20px; text-align: center; color: var(--text); box-shadow: 0 10px 30px rgba(0,0,0,0.03); }
        footer h3 { font-family: 'Cormorant Garamond', serif; font-size: 28px; color: var(--primary); margin-top: 0; margin-bottom: 10px; }
        footer p { opacity: 0.8; font-size: 15px; line-height: 1.6; max-width: 500px; margin: 0 auto; }
    </style>
</head>
<body>

    <header>
        <div class="logo-area">
            <img id="site-logo" class="logo" src="https://via.placeholder.com/100/2d6a4f/ffffff?text=M" onerror="this.onerror=null; this.src='https://via.placeholder.com/100/2d6a4f/ffffff?text=M';">
            <h1 class="app-title">Mundari Samaj</h1>
        </div>
        <div onclick="toggleMenu()" style="cursor: pointer; padding: 8px;">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2d6a4f" stroke-width="2" stroke-linecap="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
    </header>

    <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()">
        <div class="menu-center-box" onclick="event.stopPropagation()">
            <div class="menu-header-top"><div class="close-icon" onclick="toggleMenu()">&times;</div></div>
            <div class="search-wrapper">
                <input type="text" class="search-bar" placeholder="Search..." onkeyup="handleSearch(this.value)">
                <span class="search-icon">üîç</span>
                <div class="search-results" id="search-results"></div>
            </div>
            <div class="nav-vertical">
                <a href="#" class="nav-row" onclick="toggleMenu()">Home</a>
                <a href="#articles" class="nav-row" onclick="toggleMenu()">Articles</a>
                <a href="#videos" class="nav-row" onclick="toggleMenu()">Videos</a>
                <a href="#gallery" class="nav-row" onclick="toggleMenu()">Gallery</a>
            </div>
            <a href="login.html" class="login-link">Admin Login</a>
        </div>
    </div>

    <div class="slider-wrapper" id="slider"></div>

    <div style="text-align:center; padding:20px;">
        <h2 style="font-family:'Cormorant Garamond', serif; font-size:32px; color:var(--primary); margin:0;" id="w-title">Johar, Jay Mundari</h2>
        <div style="background:white; color:var(--primary); padding:6px 18px; border-radius:50px; display:inline-block; font-size:13px; margin-top:8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);" id="w-sub">Welcome</div>
    </div>

    <div class="section-title">Latest Articles</div>
    <div class="scroll-feed" id="article-feed"></div>
    <div class="section-title">Recent Videos</div>
    <div class="scroll-feed" id="video-feed"></div>
    <div class="section-title">Photo Gallery</div>
    <div class="scroll-feed" id="photo-feed"></div>

    <footer>
        <h3>About Us</h3>
        <p id="footer-text"></p>
        <div style="margin-top:25px; font-size:13px; color:#555;">
            <span id="footer-email"></span><br><br>
            ¬© 2026 Mundari Samaj
        </div>
    </footer>

    <script src="data.js"></script>
    <script>
        // --- SECURITY ---
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if (e.keyCode == 123) return false;
            if (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) return false;
            if (e.ctrlKey && e.keyCode == 85) return false;
        }

        // --- LOAD DATA & LOGO FIX ---
        if(db.admin) {
            const logoImg = document.getElementById('site-logo');
            const favicon = document.getElementById('dynamic-favicon');
            
            // If admin put a valid logo link, show it. Otherwise it naturally falls back to the "M" image.
            if(db.admin.logo && db.admin.logo.length > 5) {
                logoImg.src = db.admin.logo;
                favicon.href = db.admin.logo; // Updates browser tab logo too
            }

            document.getElementById('w-title').innerText = db.admin.welcomeTitle || "Johar, Jay Mundari";
            document.getElementById('w-sub').innerText = db.admin.welcomeSub || "Welcome";
            document.getElementById('footer-text').innerText = db.admin.footerText || "Preserving our culture.";
            document.getElementById('footer-email').innerText = db.admin.contactEmail || "Contact";
        }

        // --- MENU LOGIC ---
        function toggleMenu() {
            const overlay = document.getElementById('menu-overlay');
            overlay.classList.toggle('active');
            if (overlay.classList.contains('active')) document.body.classList.add('menu-open');
            else document.body.classList.remove('menu-open');
        }

        function handleSearch(q) {
            const res = document.getElementById('search-results');
            if(!q) { res.style.display = 'none'; return; }
            const hits = [
                ...db.articles.map(a => ({t: a.title, url: `article.html?id=${a.id}`, type: 'Article'})),
                ...db.videos.map(v => ({t: v.title, url: `video.html?id=${v.id}`, type: 'Video'}))
            ].filter(x => x.t.toLowerCase().includes(q.toLowerCase()));
            res.style.display = 'block';
            res.innerHTML = hits.length ? hits.map(h => `<div class="search-item" onclick="window.location.href='${h.url}'">${h.t}</div>`).join('') : `<div style="padding:10px;text-align:center;color:#999;">No results</div>`;
        }

        // --- RENDER LOGIC ---
        const slider = document.getElementById('slider');
        if (db.events && db.events.length > 0) {
            let sliderHTML = '';
            db.events.forEach((evt, i) => { sliderHTML += `<img src="${evt.image}" class="slide-img ${i===0 ? 'active' : ''}">`; });
            slider.innerHTML = sliderHTML;
            if(db.events.length > 1) {
                let sIdx = 0; const s = document.querySelectorAll('.slide-img');
                setInterval(() => { s[sIdx].classList.remove('active'); sIdx=(sIdx+1)%s.length; s[sIdx].classList.add('active'); }, 4000);
            }
        } else { slider.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100%;color:#aaa;'>No images available</div>"; }

        function renderFeedFast(id, data, type) {
            const container = document.getElementById(id);
            if(!data || data.length === 0) { container.innerHTML = `<div style="padding:0 20px; font-size:13px; color:#999;">No content found.</div>`; return; }
            const page = type === 'article' ? 'article.html' : type === 'video' ? 'video.html' : 'photo.html';
            
            container.innerHTML = data.map(i => {
                // Determine if it's a standard landscape YouTube video
                let isLandscape = false;
                if (type === 'video' && i.link) {
                    if ((i.link.includes('youtube.com/watch') || i.link.includes('youtu.be/')) && !i.link.includes('shorts')) {
                        isLandscape = true;
                    }
                }
                
                // Assign the correct card shape based on video type
                let cardClass = '';
                if (type === 'video') {
                    cardClass = isLandscape ? 'vid-landscape' : 'vid-card';
                }

                return `
                <div class="card ${cardClass}" onclick="window.location.href='${page}?id=${i.id}'">
                    <img src="${i.thumbnail || i.image || 'https://via.placeholder.com/150'}" class="c-img" loading="lazy">
                    ${type !== 'photo' ? `<div class="c-body"><div class="c-title">${i.title}</div></div>` : ''}
                </div>
                `;
            }).join('');
        }
        
        if(db.articles) renderFeedFast('article-feed', db.articles, 'article');
        if(db.videos) renderFeedFast('video-feed', db.videos, 'video');
        if(db.photos) renderFeedFast('photo-feed', db.photos, 'photo');
    </script>
</body>
</html>